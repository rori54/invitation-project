<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Invitation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root{--accent-color:#c5a98b;--background-color:#f8f7f5}body{margin:0;font-family:'Montserrat',sans-serif;line-height:1.7;background-color:var(--background-color);color:#333;opacity:0;transition:opacity .5s ease-in-out}h1,h2,h3{font-family:'Playfair Display',serif;text-align:center}h2{font-size:2.2rem;margin-bottom:30px}.hero{height:90vh;display:flex;flex-direction:column;justify-content:center;align-items:center;color:white;text-align:center;position:relative;background-size:cover;background-position:center}.hero::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4)}.hero-content{position:relative;z-index:2}#hero-names{font-size:4rem;margin:0}#hero-date{font-size:1.2rem;letter-spacing:2px}.content-section{max-width:800px;margin:50px auto;padding:40px;background-color:#fff;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.07);text-align:center}#countdown{display:flex;justify-content:center;gap:20px;text-align:center}.time-block{background:#f4f4f4;padding:20px;border-radius:5px;min-width:80px}.time-block .number{font-size:2.5rem;font-weight:700;color:var(--accent-color)}.schedule-list{list-style:none;padding:0;text-align:left}.schedule-item{display:flex;gap:20px;border-bottom:1px solid #eee;padding:20px 0}.schedule-item:last-child{border-bottom:none}.schedule-time{font-weight:700;color:var(--accent-color);font-size:1.2rem;min-width:70px}.schedule-event h3{margin:0;font-size:1.4rem;text-align:left}.schedule-event p{margin:5px 0 0}#location-image-container{width:100%;max-height:400px;border-radius:8px;overflow:hidden;margin-top:20px}#location-image{width:100%;height:100%;object-fit:cover}.rsvp-buttons{display:flex;justify-content:center;gap:20px;margin-top:20px}.rsvp-button{display:inline-block;background:var(--accent-color);color:#fff!important;padding:15px 30px;text-decoration:none;border-radius:50px;transition:transform .2s ease;font-size:1.1rem}.rsvp-button.decline{background-color:#888}.rsvp-button:hover{transform:scale(1.05)}
    </style>
</head>
<body>
    <!-- Default Content (will be replaced if data is loaded) -->
    <header class="hero" id="hero-section" style="background-image: url('https://images.unsplash.com/photo-1522129789378-f4d6b1365934?q=80&w=2070&auto=format&fit=crop');">
        <div class="hero-content">
            <p id="hero-subtitle">WE ARE GETTING MARRIED</p>
            <h1 id="hero-names">Robert & Kandy</h1>
            <p id="hero-date">September 15, 2025</p>
        </div>
    </header>
    <section class="content-section" id="countdown-section">
        <h2 id="countdown-title">Counting down the days</h2>
        <div id="countdown">
             <div class="time-block"><div id="days" class="number">00</div><div>Days</div></div>
             <div class="time-block"><div id="hours" class="number">00</div><div>Hours</div></div>
             <div class="time-block"><div id="minutes" class="number">00</div><div>Minutes</div></div>
             <div class="time-block"><div id="seconds" class="number">00</div><div>Seconds</div></div>
        </div>
    </section>
    <section class="content-section" id="schedule-section">
        <h2 id="schedule-main-title">The big day</h2>
        <ul class="schedule-list" id="schedule-list">
            <li class="schedule-item" data-id="1"><div class="schedule-time" id="time-1">03:00 PM</div><div class="schedule-event"><h3 id="title-1">Guest Arrival</h3><p id="desc-1">Welcome drinks and light music.</p></div></li>
            <li class="schedule-item" data-id="2"><div class="schedule-time" id="time-2">04:00 PM</div><div class="schedule-event"><h3 id="title-2">The Ceremony</h3><p id="desc-2">The most important moment of our day.</p></div></li>
            <li class="schedule-item" data-id="3"><div class="schedule-time" id="time-3">05:30 PM</div><div class="schedule-event"><h3 id="title-3">Reception</h3><p id="desc-3">Time for dinner, drinks, and dancing!</p></div></li>
            <li class="schedule-item" data-id="4"><div class="schedule-time" id="time-4">09:00 PM</div><div class="schedule-event"><h3 id="title-4">Cake Cutting</h3><p id="desc-4">The sweetest moment of the evening.</p></div></li>
        </ul>
    </section>
    <section class="content-section" id="location-section">
        <h2 id="location-title">The Venue</h2>
        <p id="location-address">The Grand Hall, 123 Celebration Ave, New York</p>
        <div id="location-image-container"><img id="location-image" src="https://images.unsplash.com/photo-1511795408833-2a1e94992e7a?q=80&w=2070&auto=format&fit=crop" alt="Venue"></div>
        <a href="#" id="location-map-link" class="rsvp-button" target="_blank" style="margin-top: 30px;">View on Map</a>
    </section>
    <section class="content-section" id="rsvp-section">
        <h2 id="rsvp-title">Will you be there?</h2>
        <p id="rsvp-subtitle">Please RSVP by September 1st so we can get a headcount.</p>
        <div class="rsvp-buttons">
            <a href="#" class="rsvp-button" id="rsvp-accept-link">I'll be there!</a>
            <a href="#" class="rsvp-button decline" id="rsvp-decline-link">Sorry, can't make it</a>
        </div>
    </section>

    <!-- Scripts -->
    <script>
        let countdownInterval;
        function startCountdown(targetDate) {
            if (!targetDate) return;
            if (countdownInterval) clearInterval(countdownInterval);
            const countDownDate = (new Date(targetDate)).getTime();
            countdownInterval = setInterval(function() {
                const now = (new Date).getTime(), distance = countDownDate - now;
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    document.getElementById("countdown").innerHTML = "<h2>The event has passed!</h2>";
                    return
                }
                document.getElementById("days").innerText = Math.floor(distance / 864e5);
                document.getElementById("hours").innerText = Math.floor(distance % 864e5 / 36e5);
                document.getElementById("minutes").innerText = Math.floor(distance % 36e5 / 6e4);
                document.getElementById("seconds").innerText = Math.floor(distance % 6e4 / 1e3)
            }, 1e3)
        }

        async function loadInvitationData() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (!id) { // If no ID, just show the default template
                document.body.style.opacity = 1;
                return;
            }

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${id}/latest`, {
                    headers: {
                        'X-Access-Key': '$2a$10$hi7HFmFJVUsbakSwraFdXueeos/ENMZJtdTVCpRdOjgV/o/7hs62e'
                    }
                });
                if (!response.ok) throw new Error('Could not fetch data.');
                
                const data = (await response.json()).record;

                // Populate text content
                Object.keys(data.text).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.innerText = data.text[key];
                });

                // Populate links
                Object.keys(data.links).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.href = data.links[key];
                });

                // Populate images
                document.getElementById('hero-section').style.backgroundImage = `url('${data.images.hero}')`;
                document.getElementById('location-image').src = data.images.location;

                // Populate schedule
                const scheduleList = document.getElementById('schedule-list');
                scheduleList.innerHTML = ''; // Clear default items
                data.schedule.forEach((item, index) => {
                    const li = document.createElement('li');
                    li.className = 'schedule-item';
                    li.dataset.id = index + 1;
                    li.innerHTML = `<div class="schedule-time">${item.time}</div><div class="schedule-event"><h3>${item.title}</h3><p>${item.desc}</p></div>`;
                    scheduleList.appendChild(li);
                });

                startCountdown(data.countdownDate);
                document.body.style.opacity = 1; // Show the populated page

            } catch (error) {
                document.body.innerHTML = `<h1>Error loading invitation</h1><p>${error.message}</p>`;
                document.body.style.opacity = 1;
            }
        }
        loadInvitationData();
    </script>
</body>
</html>